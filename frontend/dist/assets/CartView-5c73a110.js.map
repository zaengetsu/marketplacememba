{"version":3,"file":"CartView-5c73a110.js","sources":["../../src/views/CartView.vue"],"sourcesContent":["<template>\n  <div class=\"cart-view\">\n    <div class=\"container mx-auto px-4 py-8\">\n      <h1 class=\"text-3xl font-bold mb-8\">Mon Panier</h1>\n\n      <!-- Panier vide -->\n      <div v-if=\"!cartStore.hasItems\" class=\"text-center py-16\">\n        <div class=\"text-6xl mb-4\">üõí</div>\n        <h2 class=\"text-2xl font-semibold mb-4\">Votre panier est vide</h2>\n        <p class=\"text-gray-600 mb-8\">D√©couvrez nos produits et ajoutez-les √† votre panier</p>\n        <router-link to=\"/\" class=\"btn btn-primary\">\n          Continuer mes achats\n        </router-link>\n      </div>\n\n      <!-- Panier avec articles -->\n      <div v-else class=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n        <!-- Liste des articles -->\n        <div class=\"lg:col-span-2\">\n          <div class=\"card\">\n            <div class=\"card-header\">\n              <h2 class=\"text-xl font-semibold\">Articles ({{ cartStore.totalItems }})</h2>\n            </div>\n            <div class=\"card-body p-0\">\n              <div v-for=\"item in cartStore.items\" :key=\"item.product.id\"\n                class=\"flex items-center p-6 border-b border-gray-200 last:border-b-0\">\n\n                <!-- Image du produit -->\n                <div class=\"w-20 h-20 bg-gray-200 rounded-lg overflow-hidden mr-4\">\n                  <img :src=\"'/placeholder.jpg'\" :alt=\"item.product.name\" class=\"w-full h-full object-cover\">\n                </div>\n\n                <!-- D√©tails du produit -->\n                <div class=\"flex-1\">\n                  <h3 class=\"font-semibold text-lg\">{{ item.product.name }}</h3>\n                  <p class=\"text-gray-600 text-sm\">{{ item.product.category?.name || 'Cat√©gorie non d√©finie' }}</p>\n\n                  <!-- R√©servation -->\n                  <div v-if=\"item.reservedUntil\" class=\"text-xs text-orange-600 mt-1\">\n                    R√©serv√© jusqu'√† {{ formatTime(item.reservedUntil) }}\n                  </div>\n                </div>\n\n                <!-- Quantit√© -->\n                <div class=\"flex items-center mx-4\">\n                  <button @click=\"updateQuantity(item.product.id.toString(), item.quantity - 1)\"\n                    :disabled=\"item.quantity <= 1\"\n                    class=\"w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-100 disabled:opacity-50\">\n                    -\n                  </button>\n                  <span class=\"mx-3 font-semibold\">{{ item.quantity }}</span>\n                  <button @click=\"updateQuantity(item.product.id.toString(), item.quantity + 1)\"\n                    class=\"w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-100\">\n                    +\n                  </button>\n                </div>\n\n                <!-- Prix -->\n                <div class=\"text-right mr-4\">\n                  <div class=\"font-semibold\">\n                    {{ (getCurrentPrice(item.product) * item.quantity).toFixed(2) }}‚Ç¨\n                  </div>\n                  <div v-if=\"item.product.isOnSale\" class=\"text-sm text-gray-500 line-through\">\n                    {{ (item.product.price * item.quantity).toFixed(2) }}‚Ç¨\n                  </div>\n                </div>\n\n                <!-- Supprimer -->\n                <button @click=\"cartStore.removeItem(item.product.id.toString())\"\n                  class=\"text-red-500 hover:text-red-700 p-2\">\n                  üóëÔ∏è\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- R√©sum√© de commande -->\n        <div class=\"lg:col-span-1\">\n          <div class=\"card sticky top-4\">\n            <div class=\"card-header\">\n              <h2 class=\"text-xl font-semibold\">R√©sum√©</h2>\n            </div>\n            <div class=\"card-body\">\n              <div class=\"space-y-3\">\n                <div class=\"flex justify-between\">\n                  <span>Sous-total</span>\n                  <span>{{ cartStore.totalPrice.toFixed(2) }}‚Ç¨</span>\n                </div>\n                <div class=\"flex justify-between\">\n                  <span>Livraison</span>\n                  <span>Gratuite</span>\n                </div>\n                <hr>\n                <div class=\"flex justify-between font-semibold text-lg\">\n                  <span>Total</span>\n                  <span>{{ cartStore.totalPrice.toFixed(2) }}‚Ç¨</span>\n                </div>\n              </div>\n\n              <button @click=\"proceedToCheckout\" :disabled=\"checkoutLoading\" class=\"w-full btn btn-primary mt-6\">\n                <div v-if=\"checkoutLoading\"\n                  class=\"w-4 h-4 mr-2 border-2 border-white border-t-transparent rounded-full animate-spin\"></div>\n                {{ checkoutLoading ? 'Redirection...' : 'Passer commande' }}\n              </button>\n\n              <button @click=\"cartStore.clearCart\" class=\"w-full btn btn-outline mt-3\">\n                Vider le panier\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useCartStore } from '@/stores/cart'\nimport { useOrderStore } from '@/stores/orders'\nimport { useAuthStore } from '@/stores/auth'\nimport type { Product } from '@/types/product'\n\nconst router = useRouter()\nconst cartStore = useCartStore()\nconst orderStore = useOrderStore()\nconst authStore = useAuthStore()\nconst checkoutLoading = ref(false)\n\nconst getCurrentPrice = (product: Product) => {\n  if (!product) return 0\n  return product.isOnSale && product.salePrice ? product.salePrice : product.price\n}\n\nconst updateQuantity = (productId: string, quantity: number) => {\n  if (quantity <= 0) {\n    cartStore.removeItem(productId)\n  } else {\n    cartStore.updateQuantity(productId, quantity)\n  }\n}\n\nconst formatTime = (date: Date) => {\n  return date.toLocaleTimeString('fr-FR', {\n    hour: '2-digit',\n    minute: '2-digit'\n  })\n}\n\nconst proceedToCheckout = async () => {\n  if (!authStore.isAuthenticated) {\n    router.push('/login')\n    return\n  }\n\n  checkoutLoading.value = true\n\n  try {\n    // Adresse temporaire (en prod, on demanderait √† l'utilisateur)\n    const shippingAddress = {\n      street: '123 Rue Example',\n      city: 'Paris',\n      postalCode: '75001',\n      country: 'France'\n    }\n\n    // Pr√©pare les items pour le backend\n    const items = cartStore.items\n      .filter(item => item.product) // enl√®ve les items sans produit\n      .map(item => ({\n        productId: item.product.id,\n        quantity: item.quantity,\n        price: getCurrentPrice(item.product)\n      }))\n    // 1. Cr√©er commande + intention de paiement\n    const { order, paymentIntent } = await orderStore.processCheckout(\n      items,\n      shippingAddress\n    )\n\n    console.log('‚úÖ Commande cr√©√©e:', order)\n    console.log('üí≥ Intention de paiement cr√©√©e:', paymentIntent)\n\n    // 2. Demander l'URL Stripe Checkout au backend\n    const res = await fetch('/api/payments/create-checkout-session', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${authStore.token}`\n      },\n      body: JSON.stringify({\n        orderId: order.id,\n        paymentIntentId: paymentIntent.id,\n        email: authStore.user?.email // optionnel\n      })\n    })\n    const data = await res.json()\n    if (data.url) {\n      window.location.href = data.url // Redirige vers Stripe Checkout\n    } else {\n      throw new Error(data.message || 'Impossible de d√©marrer le paiement Stripe')\n    }\n\n  } catch (error: any) {\n    console.error('‚ùå Erreur lors du checkout:', error)\n    alert(`Erreur: ${error.message}`)\n  } finally {\n    checkoutLoading.value = false\n  }\n}\n</script>"],"names":["router","useRouter","cartStore","useCartStore","orderStore","useOrderStore","authStore","useAuthStore","checkoutLoading","ref","getCurrentPrice","product","updateQuantity","productId","quantity","formatTime","date","proceedToCheckout","shippingAddress","items","item","order","paymentIntent","data","_a","error","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_cache","_unref","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_Fragment","_renderList","_hoisted_10","_hoisted_12","_hoisted_13","_toDisplayString","_hoisted_14","_hoisted_15","_hoisted_16","$event","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_31","_createTextVNode","args","_hoisted_3","_createVNode","_component_router_link"],"mappings":"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"}