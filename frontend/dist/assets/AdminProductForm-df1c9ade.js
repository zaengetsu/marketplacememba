import{d as J,a as W,G as X,r as T,o as V,y as $,c as a,b as e,e as U,w as j,t as d,D as s,l as u,v as p,n as m,j as c,m as L,F as M,f as N,q as O,i as _,x as H,B as K,g as Y,h as n,p as F}from"./index-c65d1cd2.js";import{o as S,c as w,s as I,n as g,b as q,a as Z,e as ee,u as te}from"./useForm-3cd6812b.js";const se={class:"admin-product-form"},oe={class:"container mx-auto px-4 py-8"},ie={class:"flex items-center mb-8"},re={class:"text-3xl font-bold text-gray-900"},le={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},ae={class:"lg:col-span-2 space-y-6"},ne={class:"card"},de={class:"card-body space-y-4"},ue={key:0,class:"text-red-500 text-sm mt-1"},ce={key:0,class:"text-red-500 text-sm mt-1"},pe={key:0,class:"text-red-500 text-sm mt-1"},me=["value"],be={key:0,class:"text-red-500 text-sm mt-1"},ve={class:"card"},ye={class:"card-body space-y-4"},ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},fe={key:0,class:"text-red-500 text-sm mt-1"},xe={key:0,class:"text-red-500 text-sm mt-1"},ke={class:"flex items-center"},Pe={class:"card"},he={class:"card-body space-y-4"},_e={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Se={key:0,class:"text-red-500 text-sm mt-1"},we={class:"card"},Ie={class:"card-body space-y-4"},qe={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},Ae=["src","alt"],Ce=["onClick"],Te={key:0,class:"absolute bottom-1 left-1 bg-blue-500 text-white text-xs px-1 rounded"},Ve={class:"border-2 border-dashed border-gray-300 rounded flex items-center justify-center h-24 hover:border-gray-400 cursor-pointer"},Ue={class:"space-y-6"},je={class:"card"},Le={class:"card-body space-y-3"},Me=["disabled"],Ne={key:0,class:"flex items-center justify-center"},Oe={key:1},Fe=["disabled"],Re={class:"card"},Be={class:"card-body space-y-3"},De={class:"flex items-center"},Ee={class:"card"},Ge={class:"card-body"},Qe={class:"space-y-2"},ze={class:"flex justify-between"},Je={class:"font-medium"},We={key:0,class:"flex justify-between text-red-600"},Xe={class:"font-medium"},$e={key:1,class:"flex justify-between text-green-600 text-sm"},He={class:"font-medium"},et=J({__name:"AdminProductForm",setup(Ke){const f=H(),R=K(),x=W(),b=X(()=>!!f.params.id),A=T(),C=T([]);V(async()=>{const l=await $.getCategories();l.success&&l.data&&(C.value=l.data)});const B=S({name:w.required.min(2,"Le nom doit contenir au moins 2 caractères"),slug:I().optional(),description:w.required.min(10,"La description doit contenir au moins 10 caractères"),categoryId:w.required,price:g().min(.01,"Le prix doit être supérieur à 0"),salePrice:g().optional(),isOnSale:q(),stock:S({quantity:g().min(0,"La quantité ne peut pas être négative"),lowStockThreshold:g().min(0).optional()}),images:Z(S({url:I(),alt:I(),isPrimary:q()})),status:ee(["draft","active","inactive"]),isActive:q()}),D={name:"",slug:"",description:"",categoryId:"",price:0,salePrice:0,isOnSale:!1,stock:{quantity:0,lowStockThreshold:5},images:[],status:"draft",isActive:!1},{data:o,errors:r,isLoading:k,handleSubmit:P}=te({initialData:D,validationSchema:B,onSubmit:async l=>{try{const t={...l,categoryId:Number(l.categoryId),stockQuantity:l.stock.quantity,images:l.images};b.value?(await F.updateProduct(f.params.id,t),x.success("Produit modifié avec succès")):(await F.createProduct(t),x.success("Produit créé avec succès")),R.push("/admin/products")}catch{x.error("Erreur lors de la sauvegarde")}}}),E=async()=>{o.status="draft",o.isActive=!1,await P()},G=l=>{var v;const t=(v=l.target.files)==null?void 0:v[0];if(t){const i=new FileReader;i.onload=y=>{var h;o.images.push({url:(h=y.target)==null?void 0:h.result,alt:o.name||"Image produit",isPrimary:o.images.length===0})},i.readAsDataURL(t)}},Q=()=>{var l;(l=A.value)==null||l.click()},z=l=>{const t=o.images[l];o.images.splice(l,1),t.isPrimary&&o.images.length>0&&(o.images[0].isPrimary=!0)};return V(async()=>{if(b.value){const l=f.params.id;console.log("Chargement du produit:",l),Object.assign(o,{name:"iPhone 15 Pro",slug:"iphone-15-pro",description:"Le dernier smartphone Apple avec puce A17 Pro, appareil photo professionnel et écran Super Retina XDR",categoryId:"1",price:1229,salePrice:1099,isOnSale:!0,stock:{quantity:50,lowStockThreshold:5},images:[{url:"/phone.jpg",alt:"iPhone 15 Pro",isPrimary:!0}],status:"active",isActive:!0})}}),(l,t)=>{const v=Y("router-link");return n(),a("div",se,[e("div",oe,[e("div",ie,[U(v,{to:"/admin/products",class:"mr-4 text-gray-600 hover:text-gray-900"},{default:j(()=>t[12]||(t[12]=[_(" ← Retour ")])),_:1,__:[12]}),e("h1",re,d(b.value?"Modifier le produit":"Nouveau produit"),1)]),e("form",{onSubmit:t[11]||(t[11]=(...i)=>s(P)&&s(P)(...i)),class:"space-y-8"},[e("div",le,[e("div",ae,[e("div",ne,[t[19]||(t[19]=e("div",{class:"card-header"},[e("h2",{class:"text-xl font-semibold"},"Informations de base")],-1)),e("div",de,[e("div",null,[t[13]||(t[13]=e("label",{class:"form-label"},"Nom du produit *",-1)),u(e("input",{"onUpdate:modelValue":t[0]||(t[0]=i=>s(o).name=i),type:"text",class:m(["form-input",{"border-red-500":s(r).name}]),placeholder:"Ex: iPhone 15 Pro"},null,2),[[p,s(o).name]]),s(r).name?(n(),a("p",ue,d(s(r).name),1)):c("",!0)]),e("div",null,[t[14]||(t[14]=e("label",{class:"form-label"},"Slug",-1)),u(e("input",{"onUpdate:modelValue":t[1]||(t[1]=i=>s(o).slug=i),type:"text",class:m(["form-input",{"border-red-500":s(r).slug}]),placeholder:"Ex: iphone-15-pro"},null,2),[[p,s(o).slug]]),t[15]||(t[15]=e("p",{class:"text-gray-500 text-sm mt-1"},"Généré automatiquement si vide",-1)),s(r).slug?(n(),a("p",ce,d(s(r).slug),1)):c("",!0)]),e("div",null,[t[16]||(t[16]=e("label",{class:"form-label"},"Description *",-1)),u(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=i=>s(o).description=i),rows:"4",class:m(["form-input",{"border-red-500":s(r).description}]),placeholder:"Description détaillée du produit..."},null,2),[[p,s(o).description]]),s(r).description?(n(),a("p",pe,d(s(r).description),1)):c("",!0)]),e("div",null,[t[18]||(t[18]=e("label",{class:"form-label"},"Catégorie *",-1)),u(e("select",{"onUpdate:modelValue":t[3]||(t[3]=i=>s(o).categoryId=i),class:m(["form-select",{"border-red-500":s(r).categoryId}])},[t[17]||(t[17]=e("option",{value:""},"Sélectionner une catégorie",-1)),(n(!0),a(M,null,N(C.value,i=>(n(),a("option",{key:i.id,value:String(i.id)},d(i.name),9,me))),128))],2),[[L,s(o).categoryId]]),s(r).categoryId?(n(),a("p",be,d(s(r).categoryId),1)):c("",!0)])])]),e("div",ve,[t[23]||(t[23]=e("div",{class:"card-header"},[e("h2",{class:"text-xl font-semibold"},"Prix et promotions")],-1)),e("div",ye,[e("div",ge,[e("div",null,[t[20]||(t[20]=e("label",{class:"form-label"},"Prix de base (€) *",-1)),u(e("input",{"onUpdate:modelValue":t[4]||(t[4]=i=>s(o).price=i),type:"number",step:"0.01",min:"0",class:m(["form-input",{"border-red-500":s(r).price}]),placeholder:"0.00"},null,2),[[p,s(o).price,void 0,{number:!0}]]),s(r).price?(n(),a("p",fe,d(s(r).price),1)):c("",!0)]),e("div",null,[t[21]||(t[21]=e("label",{class:"form-label"},"Prix promotionnel (€)",-1)),u(e("input",{"onUpdate:modelValue":t[5]||(t[5]=i=>s(o).salePrice=i),type:"number",step:"0.01",min:"0",class:m(["form-input",{"border-red-500":s(r).salePrice}]),placeholder:"0.00"},null,2),[[p,s(o).salePrice,void 0,{number:!0}]]),s(r).salePrice?(n(),a("p",xe,d(s(r).salePrice),1)):c("",!0)])]),e("div",null,[e("label",ke,[u(e("input",{"onUpdate:modelValue":t[6]||(t[6]=i=>s(o).isOnSale=i),type:"checkbox",class:"mr-2"},null,512),[[O,s(o).isOnSale]]),t[22]||(t[22]=e("span",null,"Produit en promotion",-1))])])])]),e("div",Pe,[t[27]||(t[27]=e("div",{class:"card-header"},[e("h2",{class:"text-xl font-semibold"},"Gestion du stock")],-1)),e("div",he,[e("div",_e,[e("div",null,[t[24]||(t[24]=e("label",{class:"form-label"},"Quantité en stock *",-1)),u(e("input",{"onUpdate:modelValue":t[7]||(t[7]=i=>s(o).stock.quantity=i),type:"number",min:"0",class:m(["form-input",{"border-red-500":s(r)["stock.quantity"]}]),placeholder:"0"},null,2),[[p,s(o).stock.quantity,void 0,{number:!0}]]),s(r)["stock.quantity"]?(n(),a("p",Se,d(s(r)["stock.quantity"]),1)):c("",!0)]),e("div",null,[t[25]||(t[25]=e("label",{class:"form-label"},"Seuil de stock faible",-1)),u(e("input",{"onUpdate:modelValue":t[8]||(t[8]=i=>s(o).stock.lowStockThreshold=i),type:"number",min:"0",class:"form-input",placeholder:"5"},null,512),[[p,s(o).stock.lowStockThreshold,void 0,{number:!0}]]),t[26]||(t[26]=e("p",{class:"text-gray-500 text-sm mt-1"},"Alerte quand le stock descend sous ce seuil",-1))])])])]),e("div",we,[t[29]||(t[29]=e("div",{class:"card-header"},[e("h2",{class:"text-xl font-semibold"},"Images du produit")],-1)),e("div",Ie,[e("div",qe,[(n(!0),a(M,null,N(s(o).images,(i,y)=>(n(),a("div",{key:y,class:"relative group"},[e("img",{src:i.url,alt:i.alt,class:"w-full h-24 object-cover rounded border"},null,8,Ae),e("button",{onClick:h=>z(y),type:"button",class:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"}," × ",8,Ce),i.isPrimary?(n(),a("div",Te," Principal ")):c("",!0)]))),128)),e("div",Ve,[e("input",{type:"file",onChange:G,accept:"image/*",class:"hidden",ref_key:"imageInput",ref:A},null,544),e("button",{onClick:Q,type:"button",class:"text-gray-500 hover:text-gray-700"}," + Ajouter ")])]),t[28]||(t[28]=e("p",{class:"text-gray-500 text-sm"}," Formats acceptés: JPG, PNG, WebP. Taille max: 2MB par image. ",-1))])])]),e("div",Ue,[e("div",je,[t[32]||(t[32]=e("div",{class:"card-header"},[e("h2",{class:"text-xl font-semibold"},"Actions")],-1)),e("div",Le,[e("button",{type:"submit",disabled:s(k),class:"btn btn-primary w-full"},[s(k)?(n(),a("span",Ne,[t[30]||(t[30]=e("div",{class:"w-4 h-4 mr-2 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)),_(" "+d(b.value?"Modification...":"Création..."),1)])):(n(),a("span",Oe,d(b.value?"Modifier le produit":"Créer le produit"),1))],8,Me),e("button",{onClick:E,type:"button",class:"btn btn-outline w-full",disabled:s(k)}," Sauvegarder en brouillon ",8,Fe),U(v,{to:"/admin/products",class:"btn btn-outline w-full block text-center"},{default:j(()=>t[31]||(t[31]=[_(" Annuler ")])),_:1,__:[31]})])]),e("div",Re,[t[36]||(t[36]=e("div",{class:"card-header"},[e("h2",{class:"text-xl font-semibold"},"Statut")],-1)),e("div",Be,[e("div",null,[t[34]||(t[34]=e("label",{class:"form-label"},"Statut du produit",-1)),u(e("select",{"onUpdate:modelValue":t[9]||(t[9]=i=>s(o).status=i),class:"form-select"},t[33]||(t[33]=[e("option",{value:"draft"},"Brouillon",-1),e("option",{value:"active"},"Actif",-1),e("option",{value:"inactive"},"Inactif",-1)]),512),[[L,s(o).status]])]),e("div",null,[e("label",De,[u(e("input",{"onUpdate:modelValue":t[10]||(t[10]=i=>s(o).isActive=i),type:"checkbox",class:"mr-2"},null,512),[[O,s(o).isActive]]),t[35]||(t[35]=e("span",null,"Produit visible sur le site",-1))])])])]),e("div",Ee,[t[40]||(t[40]=e("div",{class:"card-header"},[e("h2",{class:"text-xl font-semibold"},"Aperçu des prix")],-1)),e("div",Ge,[e("div",Qe,[e("div",ze,[t[37]||(t[37]=e("span",null,"Prix de base:",-1)),e("span",Je,d(s(o).price||0)+"€",1)]),s(o).isOnSale&&s(o).salePrice?(n(),a("div",We,[t[38]||(t[38]=e("span",null,"Prix promotionnel:",-1)),e("span",Xe,d(s(o).salePrice)+"€",1)])):c("",!0),s(o).isOnSale&&s(o).salePrice?(n(),a("div",$e,[t[39]||(t[39]=e("span",null,"Économie:",-1)),e("span",He,d((s(o).price-s(o).salePrice).toFixed(2))+"€",1)])):c("",!0)])])])])])],32)])])}}});export{et as default};
//# sourceMappingURL=AdminProductForm-df1c9ade.js.map
