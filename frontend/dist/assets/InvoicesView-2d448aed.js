import{u as D}from"./orders-e52484dc.js";import{d as $,C as A,r as _,o as S,c as a,b as e,D as b,e as j,w as V,F as h,f as k,j as i,t as r,n as v,g as L,h as l,i as P}from"./index-c65d1cd2.js";const N={class:"invoices-view"},B={class:"container mx-auto px-4 py-8"},I={key:0,class:"text-center py-16"},R={key:1,class:"text-center py-16"},T={key:2,class:"space-y-6"},z={class:"card-body"},U={class:"flex flex-col md:flex-row md:items-center md:justify-between mb-4"},M={class:"text-lg font-semibold"},O={class:"text-gray-600 text-sm"},q={key:0,class:"text-gray-600 text-sm"},G={class:"mt-2 md:mt-0 flex items-center space-x-4"},H={class:"text-lg font-semibold"},J={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 text-sm"},K={class:"ml-2"},Q={key:0},W={class:"ml-2 text-green-600 font-medium"},X={class:"flex flex-wrap gap-2"},Y=["onClick"],Z=["onClick"],tt=["onClick"],et={key:0,class:"flex justify-center mt-8"},st={class:"flex space-x-2"},ot=["onClick"],nt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},rt={class:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto"},at={class:"p-6"},lt={class:"flex justify-between items-center mb-4"},dt={class:"text-xl font-semibold"},it={class:"space-y-4"},ut={class:"text-xl font-semibold"},ct={class:"text-gray-600"},mt={class:"text-gray-600"},pt={key:0},bt={class:"text-green-600 font-medium"},vt={key:1},xt={class:"text-gray-600"},gt={class:"flex justify-end space-x-2 mt-6"},ht=$({__name:"InvoicesView",setup(yt){const w=A(),c=D(),n=_(null),m=_(null);S(async()=>{await x()});const x=async(o=1)=>{try{const t=await c.fetchInvoices({page:o,limit:10});m.value=t.pagination}catch(t){console.error("Erreur lors du chargement des factures:",t),alert(`Erreur: ${t.message}`)}},C=o=>{x(o)},E=async o=>{try{const t=c.invoices.find(p=>p.id===o);if(t)n.value=t;else throw new Error("Facture non trouvÃ©e")}catch(t){console.error("Erreur lors du chargement des dÃ©tails:",t),alert(`Erreur: ${t.message}`)}},g=async o=>{try{const t=await fetch(`/api/invoices/${o}/pdf`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${w.token}`}});if(!t.ok)throw new Error("Erreur lors du tÃ©lÃ©chargement du PDF");const p=await t.blob(),s=window.URL.createObjectURL(p),d=document.createElement("a");d.href=s,d.download=`facture-${o}.pdf`,document.body.appendChild(d),d.click(),d.remove(),window.URL.revokeObjectURL(s)}catch(t){console.error("Erreur lors du tÃ©lÃ©chargement:",t),alert(`Erreur: ${t.message}`)}},F=async o=>{try{console.log("Envoyer facture par email:",o),alert("Facture envoyÃ©e par email (fonctionnalitÃ© Ã  implÃ©menter)")}catch(t){console.error("Erreur lors de l'envoi:",t),alert(`Erreur: ${t.message}`)}},y=o=>({draft:"bg-gray-100 text-gray-800",sent:"bg-blue-100 text-blue-800",paid:"bg-green-100 text-green-800",overdue:"bg-red-100 text-red-800",cancelled:"bg-red-100 text-red-800"})[o]||"bg-gray-100 text-gray-800",f=o=>({draft:"Brouillon",sent:"EnvoyÃ©e",paid:"PayÃ©e",overdue:"En retard",cancelled:"AnnulÃ©e"})[o]||o,u=o=>new Date(o).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"});return(o,t)=>{const p=L("router-link");return l(),a("div",N,[e("div",B,[t[10]||(t[10]=e("h1",{class:"text-3xl font-bold mb-8"},"Mes Factures",-1)),b(c).isLoading?(l(),a("div",I,t[3]||(t[3]=[e("div",{class:"inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"},null,-1),e("p",{class:"mt-4 text-gray-600"},"Chargement des factures...",-1)]))):b(c).invoices.length===0?(l(),a("div",R,[t[5]||(t[5]=e("div",{class:"text-6xl mb-4"},"ðŸ§¾",-1)),t[6]||(t[6]=e("h2",{class:"text-2xl font-semibold mb-4"},"Aucune facture",-1)),t[7]||(t[7]=e("p",{class:"text-gray-600 mb-8"},"Vous n'avez pas encore de facture disponible",-1)),j(p,{to:"/orders",class:"btn btn-primary"},{default:V(()=>t[4]||(t[4]=[P(" Voir mes commandes ")])),_:1,__:[4]})])):(l(),a("div",T,[(l(!0),a(h,null,k(b(c).invoices,s=>(l(),a("div",{key:s.id,class:"card"},[e("div",z,[e("div",U,[e("div",null,[e("h3",M,r(s.invoiceNumber),1),e("p",O," Ã‰mise le "+r(u(s.issuedAt)),1),s.order?(l(),a("p",q," Commande #"+r(s.order.id),1)):i("",!0)]),e("div",G,[e("span",{class:v([y(s.status),"px-3 py-1 rounded-full text-sm font-medium"])},r(f(s.status)),3),e("span",H,r(parseFloat(s.amount.toString()).toFixed(2))+"â‚¬",1)])]),e("div",J,[e("div",null,[t[8]||(t[8]=e("span",{class:"text-gray-500"},"Date d'Ã©chÃ©ance :",-1)),e("span",K,r(u(s.dueAt)),1)]),s.paidAt?(l(),a("div",Q,[t[9]||(t[9]=e("span",{class:"text-gray-500"},"PayÃ©e le :",-1)),e("span",W,r(u(s.paidAt)),1)])):i("",!0)]),e("div",X,[e("button",{onClick:d=>E(s.id),class:"btn btn-outline btn-sm"}," Voir dÃ©tails ",8,Y),e("button",{onClick:d=>g(s.id),class:"btn btn-primary btn-sm"}," ðŸ“„ TÃ©lÃ©charger PDF ",8,Z),s.status==="draft"?(l(),a("button",{key:0,onClick:d=>F(s.id),class:"btn btn-outline btn-sm"}," ðŸ“§ Envoyer par email ",8,tt)):i("",!0)])])]))),128)),m.value&&m.value.pages>1?(l(),a("div",et,[e("div",st,[(l(!0),a(h,null,k(m.value.pages,s=>(l(),a("button",{key:s,onClick:d=>C(s),class:v(["px-3 py-2 rounded-md text-sm font-medium",s===m.value.page?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"])},r(s),11,ot))),128))])])):i("",!0)]))]),n.value?(l(),a("div",nt,[e("div",rt,[e("div",at,[e("div",lt,[e("h2",dt,r(n.value.invoiceNumber),1),e("button",{onClick:t[0]||(t[0]=s=>n.value=null),class:"text-gray-500 hover:text-gray-700"}," âœ• ")]),e("div",it,[e("div",null,[t[11]||(t[11]=e("h3",{class:"font-medium mb-2"},"Statut",-1)),e("span",{class:v([y(n.value.status),"px-3 py-1 rounded-full text-sm font-medium"])},r(f(n.value.status)),3)]),e("div",null,[t[12]||(t[12]=e("h3",{class:"font-medium mb-2"},"Montant",-1)),e("span",ut,r(parseFloat(n.value.amount.toString()).toFixed(2))+"â‚¬",1)]),e("div",null,[t[13]||(t[13]=e("h3",{class:"font-medium mb-2"},"Date d'Ã©mission",-1)),e("p",ct,r(u(n.value.issuedAt)),1)]),e("div",null,[t[14]||(t[14]=e("h3",{class:"font-medium mb-2"},"Date d'Ã©chÃ©ance",-1)),e("p",mt,r(u(n.value.dueAt)),1)]),n.value.paidAt?(l(),a("div",pt,[t[15]||(t[15]=e("h3",{class:"font-medium mb-2"},"Date de paiement",-1)),e("p",bt,r(u(n.value.paidAt)),1)])):i("",!0),n.value.order?(l(),a("div",vt,[t[16]||(t[16]=e("h3",{class:"font-medium mb-2"},"Commande liÃ©e",-1)),e("p",xt," Commande #"+r(n.value.order.id)+" ("+r(parseFloat(n.value.order.total.toString()).toFixed(2))+"â‚¬) ",1)])):i("",!0)]),e("div",gt,[e("button",{onClick:t[1]||(t[1]=s=>g(n.value.id)),class:"btn btn-primary"}," ðŸ“„ TÃ©lÃ©charger PDF "),e("button",{onClick:t[2]||(t[2]=s=>n.value=null),class:"btn btn-outline"}," Fermer ")])])])])):i("",!0)])}}});export{ht as default};
//# sourceMappingURL=InvoicesView-2d448aed.js.map
