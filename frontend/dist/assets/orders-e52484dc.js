import{I as g,r as l,G as w,J as d}from"./index-c65d1cd2.js";const k=g("orders",()=>{const c=l([]),f=l([]),o=l(null),u=l(null),n=l(!1),h=w(()=>c.value.filter(r=>r.status==="pending")),E=w(()=>c.value.filter(r=>["delivered","completed"].includes(r.status))),v=async r=>{var t,a;n.value=!0;try{const e=await d.orders.create(r);if(e.data.success)return o.value=e.data.data,c.value.unshift(e.data.data),e.data.data;throw new Error(e.data.message||"Erreur lors de la création de la commande")}catch(e){throw new Error(((a=(t=e.response)==null?void 0:t.data)==null?void 0:a.message)||"Erreur lors de la création de la commande")}finally{n.value=!1}},p=async(r,t)=>{var a,e;n.value=!0;try{const s=await d.payments.createIntent({amount:r,currency:"eur",orderId:t});if(s.data.success)return u.value={id:s.data.data.paymentIntentId,clientSecret:s.data.data.clientSecret,amount:r*100,currency:"eur",status:"requires_payment_method"},u.value;throw new Error(s.data.message||"Erreur lors de la création du paiement")}catch(s){throw new Error(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.message)||"Erreur lors de la création du paiement")}finally{n.value=!1}};return{orders:c,invoices:f,currentOrder:o,currentPaymentIntent:u,isLoading:n,pendingOrders:h,completedOrders:E,createOrder:v,createPaymentIntent:p,confirmPayment:async(r,t)=>{var a,e;n.value=!0;try{const s=await d.payments.confirm({paymentIntentId:r,orderId:t});if(s.data.success){if(o.value){o.value.status="confirmed";const i=c.value.findIndex(m=>m.id===o.value.id);i!==-1&&(c.value[i]={...o.value})}return s.data.data}throw new Error(s.data.message||"Erreur lors de la confirmation du paiement")}catch(s){throw new Error(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.message)||"Erreur lors de la confirmation du paiement")}finally{n.value=!1}},fetchOrders:async r=>{var t,a;n.value=!0;try{const e=await d.orders.getAll(r);if(e.data.success)return c.value=e.data.data.orders,e.data.data;throw new Error(e.data.message||"Erreur lors de la récupération des commandes")}catch(e){throw new Error(((a=(t=e.response)==null?void 0:t.data)==null?void 0:a.message)||"Erreur lors de la récupération des commandes")}finally{n.value=!1}},fetchOrderById:async r=>{var t,a;n.value=!0;try{const e=await d.orders.getById(r);if(e.data.success)return o.value=e.data.data,e.data.data;throw new Error(e.data.message||"Commande non trouvée")}catch(e){throw new Error(((a=(t=e.response)==null?void 0:t.data)==null?void 0:a.message)||"Erreur lors de la récupération de la commande")}finally{n.value=!1}},fetchInvoices:async r=>{var t,a;n.value=!0;try{const e=await d.invoices.getAll(r);if(e.data.success)return f.value=e.data.data.invoices,e.data.data;throw new Error(e.data.message||"Erreur lors de la récupération des factures")}catch(e){throw new Error(((a=(t=e.response)==null?void 0:t.data)==null?void 0:a.message)||"Erreur lors de la récupération des factures")}finally{n.value=!1}},processCheckout:async(r,t,a)=>{try{const e=r.reduce((m,y)=>m+y.price*y.quantity,0),s=await v({total:e,shippingAddress:t,billingAddress:a||t,items:r}),i=await p(e,s.id);return{order:s,paymentIntent:i}}catch(e){throw e}},clearCurrentOrder:()=>{o.value=null,u.value=null}}});export{k as u};
//# sourceMappingURL=orders-e52484dc.js.map
