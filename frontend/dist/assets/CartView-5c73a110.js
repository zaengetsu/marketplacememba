import{d as w,u as S,C as j,r as I,c as i,b as t,D as a,e as P,w as q,t as n,F,f as T,j as b,i as v,B as V,g as R,h as l}from"./index-c65d1cd2.js";import{u as A}from"./orders-e52484dc.js";const B={class:"cart-view"},E={class:"container mx-auto px-4 py-8"},N={key:0,class:"text-center py-16"},O={key:1,class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},$={class:"lg:col-span-2"},L={class:"card"},z={class:"card-header"},D={class:"text-xl font-semibold"},Q={class:"card-body p-0"},U={class:"w-20 h-20 bg-gray-200 rounded-lg overflow-hidden mr-4"},G=["alt"],J={class:"flex-1"},M={class:"font-semibold text-lg"},H={class:"text-gray-600 text-sm"},K={key:0,class:"text-xs text-orange-600 mt-1"},W={class:"flex items-center mx-4"},X=["onClick","disabled"],Y={class:"mx-3 font-semibold"},Z=["onClick"],tt={class:"text-right mr-4"},et={class:"font-semibold"},st={key:0,class:"text-sm text-gray-500 line-through"},ot=["onClick"],rt={class:"lg:col-span-1"},nt={class:"card sticky top-4"},it={class:"card-body"},at={class:"space-y-3"},lt={class:"flex justify-between"},dt={class:"flex justify-between font-semibold text-lg"},ct=["disabled"],ut={key:0,class:"w-4 h-4 mr-2 border-2 border-white border-t-transparent rounded-full animate-spin"},_t=w({__name:"CartView",setup(pt){const g=V(),r=S(),x=A(),p=j(),d=I(!1),f=o=>o?o.isOnSale&&o.salePrice?o.salePrice:o.price:0,y=(o,e)=>{e<=0?r.removeItem(o):r.updateQuantity(o,e)},k=o=>o.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),C=async()=>{var o;if(!p.isAuthenticated){g.push("/login");return}d.value=!0;try{const e={street:"123 Rue Example",city:"Paris",postalCode:"75001",country:"France"},m=r.items.filter(u=>u.product).map(u=>({productId:u.product.id,quantity:u.quantity,price:f(u.product)})),{order:s,paymentIntent:c}=await x.processCheckout(m,e);console.log("✅ Commande créée:",s),console.log("💳 Intention de paiement créée:",c);const _=await(await fetch("/api/payments/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p.token}`},body:JSON.stringify({orderId:s.id,paymentIntentId:c.id,email:(o=p.user)==null?void 0:o.email})})).json();if(_.url)window.location.href=_.url;else throw new Error(_.message||"Impossible de démarrer le paiement Stripe")}catch(e){console.error("❌ Erreur lors du checkout:",e),alert(`Erreur: ${e.message}`)}finally{d.value=!1}};return(o,e)=>{const m=R("router-link");return l(),i("div",B,[t("div",E,[e[10]||(e[10]=t("h1",{class:"text-3xl font-bold mb-8"},"Mon Panier",-1)),a(r).hasItems?(l(),i("div",O,[t("div",$,[t("div",L,[t("div",z,[t("h2",D,"Articles ("+n(a(r).totalItems)+")",1)]),t("div",Q,[(l(!0),i(F,null,T(a(r).items,s=>{var c;return l(),i("div",{key:s.product.id,class:"flex items-center p-6 border-b border-gray-200 last:border-b-0"},[t("div",U,[t("img",{src:"/placeholder.jpg",alt:s.product.name,class:"w-full h-full object-cover"},null,8,G)]),t("div",J,[t("h3",M,n(s.product.name),1),t("p",H,n(((c=s.product.category)==null?void 0:c.name)||"Catégorie non définie"),1),s.reservedUntil?(l(),i("div",K," Réservé jusqu'à "+n(k(s.reservedUntil)),1)):b("",!0)]),t("div",W,[t("button",{onClick:h=>y(s.product.id.toString(),s.quantity-1),disabled:s.quantity<=1,class:"w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-100 disabled:opacity-50"}," - ",8,X),t("span",Y,n(s.quantity),1),t("button",{onClick:h=>y(s.product.id.toString(),s.quantity+1),class:"w-8 h-8 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-100"}," + ",8,Z)]),t("div",tt,[t("div",et,n((f(s.product)*s.quantity).toFixed(2))+"€ ",1),s.product.isOnSale?(l(),i("div",st,n((s.product.price*s.quantity).toFixed(2))+"€ ",1)):b("",!0)]),t("button",{onClick:h=>a(r).removeItem(s.product.id.toString()),class:"text-red-500 hover:text-red-700 p-2"}," 🗑️ ",8,ot)])}),128))])])]),t("div",rt,[t("div",nt,[e[9]||(e[9]=t("div",{class:"card-header"},[t("h2",{class:"text-xl font-semibold"},"Résumé")],-1)),t("div",it,[t("div",at,[t("div",lt,[e[5]||(e[5]=t("span",null,"Sous-total",-1)),t("span",null,n(a(r).totalPrice.toFixed(2))+"€",1)]),e[7]||(e[7]=t("div",{class:"flex justify-between"},[t("span",null,"Livraison"),t("span",null,"Gratuite")],-1)),e[8]||(e[8]=t("hr",null,null,-1)),t("div",dt,[e[6]||(e[6]=t("span",null,"Total",-1)),t("span",null,n(a(r).totalPrice.toFixed(2))+"€",1)])]),t("button",{onClick:C,disabled:d.value,class:"w-full btn btn-primary mt-6"},[d.value?(l(),i("div",ut)):b("",!0),v(" "+n(d.value?"Redirection...":"Passer commande"),1)],8,ct),t("button",{onClick:e[0]||(e[0]=(...s)=>a(r).clearCart&&a(r).clearCart(...s)),class:"w-full btn btn-outline mt-3"}," Vider le panier ")])])])])):(l(),i("div",N,[e[2]||(e[2]=t("div",{class:"text-6xl mb-4"},"🛒",-1)),e[3]||(e[3]=t("h2",{class:"text-2xl font-semibold mb-4"},"Votre panier est vide",-1)),e[4]||(e[4]=t("p",{class:"text-gray-600 mb-8"},"Découvrez nos produits et ajoutez-les à votre panier",-1)),P(m,{to:"/",class:"btn btn-primary"},{default:q(()=>e[1]||(e[1]=[v(" Continuer mes achats ")])),_:1,__:[1]})]))])])}}});export{_t as default};
//# sourceMappingURL=CartView-5c73a110.js.map
